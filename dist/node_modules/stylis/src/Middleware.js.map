{"version":3,"file":"Middleware.js","sources":["../../../../node_modules/stylis/src/Middleware.js"],"sourcesContent":["import {MS, MOZ, WEBKIT, RULESET, KEYFRAMES, DECLARATION} from './Enum.js'\nimport {match, charat, substr, strlen, sizeof, replace, combine, filter, assign} from './Utility.js'\nimport {copy, lift, tokenize} from './Tokenizer.js'\nimport {serialize} from './Serializer.js'\nimport {prefix} from './Prefixer.js'\n\n/**\n * @param {function[]} collection\n * @return {function}\n */\nexport function middleware (collection) {\n\tvar length = sizeof(collection)\n\n\treturn function (element, index, children, callback) {\n\t\tvar output = ''\n\n\t\tfor (var i = 0; i < length; i++)\n\t\t\toutput += collection[i](element, index, children, callback) || ''\n\n\t\treturn output\n\t}\n}\n\n/**\n * @param {function} callback\n * @return {function}\n */\nexport function rulesheet (callback) {\n\treturn function (element) {\n\t\tif (!element.root)\n\t\t\tif (element = element.return)\n\t\t\t\tcallback(element)\n\t}\n}\n\n/**\n * @param {object} element\n * @param {number} index\n * @param {object[]} children\n * @param {function} callback\n */\nexport function prefixer (element, index, children, callback) {\n\tif (element.length > -1)\n\t\tif (!element.return)\n\t\t\tswitch (element.type) {\n\t\t\t\tcase DECLARATION: element.return = prefix(element.value, element.length, children)\n\t\t\t\t\treturn\n\t\t\t\tcase KEYFRAMES:\n\t\t\t\t\treturn serialize([copy(element, {value: replace(element.value, '@', '@' + WEBKIT)})], callback)\n\t\t\t\tcase RULESET:\n\t\t\t\t\tif (element.length)\n\t\t\t\t\t\treturn combine(children = element.props, function (value) {\n\t\t\t\t\t\t\tswitch (match(value, callback = /(::plac\\w+|:read-\\w+)/)) {\n\t\t\t\t\t\t\t\t// :read-(only|write)\n\t\t\t\t\t\t\t\tcase ':read-only': case ':read-write':\n\t\t\t\t\t\t\t\t\tlift(copy(element, {props: [replace(value, /:(read-\\w+)/, ':' + MOZ + '$1')]}))\n\t\t\t\t\t\t\t\t\tlift(copy(element, {props: [value]}))\n\t\t\t\t\t\t\t\t\tassign(element, {props: filter(children, callback)})\n\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t// :placeholder\n\t\t\t\t\t\t\t\tcase '::placeholder':\n\t\t\t\t\t\t\t\t\tlift(copy(element, {props: [replace(value, /:(plac\\w+)/, ':' + WEBKIT + 'input-$1')]}))\n\t\t\t\t\t\t\t\t\tlift(copy(element, {props: [replace(value, /:(plac\\w+)/, ':' + MOZ + '$1')]}))\n\t\t\t\t\t\t\t\t\tlift(copy(element, {props: [replace(value, /:(plac\\w+)/, MS + 'input-$1')]}))\n\t\t\t\t\t\t\t\t\tlift(copy(element, {props: [value]}))\n\t\t\t\t\t\t\t\t\tassign(element, {props: filter(children, callback)})\n\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn ''\n\t\t\t\t\t\t})\n\t\t\t}\n}\n\n/**\n * @param {object} element\n * @param {number} index\n * @param {object[]} children\n */\nexport function namespace (element) {\n\tswitch (element.type) {\n\t\tcase RULESET:\n\t\t\telement.props = element.props.map(function (value) {\n\t\t\t\treturn combine(tokenize(value), function (value, index, children) {\n\t\t\t\t\tswitch (charat(value, 0)) {\n\t\t\t\t\t\t// \\f\n\t\t\t\t\t\tcase 12:\n\t\t\t\t\t\t\treturn substr(value, 1, strlen(value))\n\t\t\t\t\t\t// \\0 ( + > ~\n\t\t\t\t\t\tcase 0: case 40: case 43: case 62: case 126:\n\t\t\t\t\t\t\treturn value\n\t\t\t\t\t\t// :\n\t\t\t\t\t\tcase 58:\n\t\t\t\t\t\t\tif (children[++index] === 'global')\n\t\t\t\t\t\t\t\tchildren[index] = '', children[++index] = '\\f' + substr(children[index], index = 1, -1)\n\t\t\t\t\t\t// \\s\n\t\t\t\t\t\tcase 32:\n\t\t\t\t\t\t\treturn index === 1 ? '' : value\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tswitch (index) {\n\t\t\t\t\t\t\t\tcase 0: element = value\n\t\t\t\t\t\t\t\t\treturn sizeof(children) > 1 ? '' : value\n\t\t\t\t\t\t\t\tcase index = sizeof(children) - 1: case 2:\n\t\t\t\t\t\t\t\t\treturn index === 2 ? value + element + element : value + element\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\treturn value\n\t\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t})\n\t}\n}\n"],"names":["middleware","collection","length","sizeof","element","index","children","callback","output","i","rulesheet","prefixer","DECLARATION","prefix","KEYFRAMES","serialize","copy","replace","WEBKIT","RULESET","combine","value","match","lift","MOZ","assign","filter","MS"],"mappings":";;;;;AAUO,SAASA,EAAYC,GAAY;AACvC,MAAIC,IAASC,EAAOF,CAAU;AAE9B,SAAO,SAAUG,GAASC,GAAOC,GAAUC,GAAU;AAGpD,aAFIC,IAAS,IAEJC,IAAI,GAAGA,IAAIP,GAAQO;AAC3B,MAAAD,KAAUP,EAAWQ,CAAC,EAAEL,GAASC,GAAOC,GAAUC,CAAQ,KAAK;AAEhE,WAAOC;AAAA,EACR;AACD;AAMO,SAASE,EAAWH,GAAU;AACpC,SAAO,SAAUH,GAAS;AACzB,IAAKA,EAAQ,SACRA,IAAUA,EAAQ,WACrBG,EAASH,CAAO;AAAA,EACnB;AACD;AAQO,SAASO,EAAUP,GAASC,GAAOC,GAAUC,GAAU;AAC7D,MAAIH,EAAQ,SAAS,MAChB,CAACA,EAAQ;AACZ,YAAQA,EAAQ,MAAI;AAAA,MACnB,KAAKQ;AAAa,QAAAR,EAAQ,SAASS,EAAOT,EAAQ,OAAOA,EAAQ,QAAQE,CAAQ;AAChF;AAAA,MACD,KAAKQ;AACJ,eAAOC,EAAU,CAACC,EAAKZ,GAAS,EAAC,OAAOa,EAAQb,EAAQ,OAAO,KAAK,MAAMc,CAAM,EAAC,CAAC,CAAC,GAAGX,CAAQ;AAAA,MAC/F,KAAKY;AACJ,YAAIf,EAAQ;AACX,iBAAOgB,EAAQd,IAAWF,EAAQ,OAAO,SAAUiB,GAAO;AACzD,oBAAQC,EAAMD,GAAOd,IAAW,uBAAuB,GAAC;AAAA;AAAA,cAEvD,KAAK;AAAA,cAAc,KAAK;AACvB,gBAAAgB,EAAKP,EAAKZ,GAAS,EAAC,OAAO,CAACa,EAAQI,GAAO,eAAe,MAAMG,IAAM,IAAI,CAAC,EAAC,CAAC,CAAC,GAC9ED,EAAKP,EAAKZ,GAAS,EAAC,OAAO,CAACiB,CAAK,EAAC,CAAC,CAAC,GACpCI,EAAOrB,GAAS,EAAC,OAAOsB,EAAOpB,GAAUC,CAAQ,EAAC,CAAC;AACnD;AAAA;AAAA,cAED,KAAK;AACJ,gBAAAgB,EAAKP,EAAKZ,GAAS,EAAC,OAAO,CAACa,EAAQI,GAAO,cAAc,MAAMH,IAAS,UAAU,CAAC,EAAC,CAAC,CAAC,GACtFK,EAAKP,EAAKZ,GAAS,EAAC,OAAO,CAACa,EAAQI,GAAO,cAAc,MAAMG,IAAM,IAAI,CAAC,EAAC,CAAC,CAAC,GAC7ED,EAAKP,EAAKZ,GAAS,EAAC,OAAO,CAACa,EAAQI,GAAO,cAAcM,IAAK,UAAU,CAAC,EAAC,CAAC,CAAC,GAC5EJ,EAAKP,EAAKZ,GAAS,EAAC,OAAO,CAACiB,CAAK,EAAC,CAAC,CAAC,GACpCI,EAAOrB,GAAS,EAAC,OAAOsB,EAAOpB,GAAUC,CAAQ,EAAC,CAAC;AACnD;AAAA,YACT;AAEO,mBAAO;AAAA,UACR,CAAC;AAAA,IACP;AACA;","x_google_ignoreList":[0]}